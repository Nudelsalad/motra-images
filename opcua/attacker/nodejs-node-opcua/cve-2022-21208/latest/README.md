# OPC UA DoS Attacker (node-opcua CVE-2022-21208)

This container exploits CVE-2022-21208 in node-opcua (versions before 2.74.0) by sending an unlimited number of large, non-final OPN chunks to exhaust server resources and cause denial of service.

## Vulnerability Details

- **CVE**: CVE-2022-21208
- **Published**: 2022-08-23
- **Impact**: Denial of Service (DoS)
- **Root cause**: Missing limitation on the number of received chunks per session or total
- **Attack vector**: Send large chunks (e.g., 1-2 GB each) without sending the Final chunk

## Implementation

- **Language**: Python 3 (raw sockets, no dependencies)
- **Protocol**: OPC UA TCP (UASC) with crafted OpenSecureChannel chunks
- **Strategy**: 
  1. TCP connect to target server
  2. Perform UA Hello/Ack handshake
  3. Send continuous OPN chunks marked as 'Intermediate' (never 'Final')
  4. Each chunk contains configurable payload size
  5. Server accumulates chunks in memory without limit → resource exhaustion

## Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `HOST` | `opcua-server` | Target server hostname/IP |
| `PORT` | `4840` | Target OPC UA port |
| `CONNECTIONS` | `1` | Number of parallel TCP connections |
| `CHUNK_SIZE` | `1048576` | Payload size per chunk in bytes (1 MiB default) |
| `SLEEP_BETWEEN` | `0` | Seconds to sleep between chunks (float) |
| `LOG_EVERY` | `100` | Log progress every N chunks per connection |

## Usage

### From motra-setups compose stack

The easiest way is to add this service to your existing compose file:

```yaml
  cve-attacker:
    container_name: "cve-attacker"
    hostname: "cve-attacker"
    image: opcua-dos-attacker:latest
    build:
      context: ${IMAGE_REPO_URL}#main:opcua/attacker/nodejs-node-opcua/cve-2022-21208/latest
    environment:
      - HOST=plc-server
      - PORT=4840
      - CONNECTIONS=2
      - CHUNK_SIZE=2097152  # 2 MiB chunks
      - SLEEP_BETWEEN=0.1
      - LOG_EVERY=50
    networks:
      - plc-net
    depends_on:
      - plc-server
```

### Standalone Docker

```bash
# Build
docker build -t opcua-dos-attacker .

# Run against local server
docker run --rm --network host \
  -e HOST=127.0.0.1 \
  -e PORT=4840 \
  -e CONNECTIONS=1 \
  opcua-dos-attacker
```

## Thesis Integration

For your sched-ext scheduling algorithm analysis:

1. **Baseline**: Run compose stack without attacker, measure normal resource usage
2. **Attack scenario**: Start attacker service, observe:
   - CPU usage spike on targeted container
   - Memory exhaustion
   - Impact on co-located services
   - Scheduler behavior under DoS conditions
3. **Metrics**: Monitor with cgroups, docker stats, or your custom instrumentation

## Security Warning

⚠️ **Use only in isolated test environments you control.** This tool performs active denial of service attacks and will disrupt targeted systems.

## References

- CVE-2022-21208: https://nvd.nist.gov/vuln/detail/CVE-2022-21208
- node-opcua GitHub: https://github.com/node-opcua/node-opcua
- OPC UA TCP specification: OPC UA Part 6
